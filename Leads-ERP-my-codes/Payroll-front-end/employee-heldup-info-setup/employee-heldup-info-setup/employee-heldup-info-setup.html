<div class="page-wrapper">
    <div class="panel">
        <div class="transaction-grid-container">

            <!-- Employee Information Section -->
            <section class="header-section">
                <app-expansion-panel-header [isOpenSignal]="employeeInformationSetup"
                    [panelTitle]="'Employee Information'">
                </app-expansion-panel-header>

                @if(employeeInformationSetup()){
                <div class="pb-2">
                    <div class="grid md:grid-cols-6 gap-4 gap-x-12 mt-3 " [formGroup]="employeeFrm">

                        <input-search-box 
                            class="col-span-2" 
                            [frmGroup]="employeeFrm" 
                            [controlName]="'id'"
                            [label]="'Employee ID'" 
                            [displayMode]="'horizontal'" 
                            [isDotsVisible]="true" 
                            [isReadonly]="isEdit"
                            [maxLen]="30"
                            (dotsClicked)="showEmployeeModal.set(true)" 
                            (onEnterPressed)="onEmployeeIdEnter($event)"
                            [tooltip]="'Enter Employee ID or click search to browse'" 
                        />

                        <input-display-field 
                            [frmGroup]="employeeFrm" 
                            [controlName]="'name'" 
                            [label]="'Name'"
                            [displayMode]="'horizontal'" 
                        />

                        <input-display-field 
                            [frmGroup]="employeeFrm" 
                            [controlName]="'designation'"
                            [label]="'Designation'" 
                            [displayMode]="'horizontal'" 
                        />

                        <input-display-field 
                            [frmGroup]="employeeFrm" 
                            [controlName]="'department'"
                            [label]="'Department'" 
                            [displayMode]="'horizontal'" 
                        />

                    </div>
                </div>
                }
            </section>
        </div>
    </div>

    <!-- ---- Heldup Setup Form Section --------- -->
    <div class="panel mt-3">
        <div class="transaction-grid-container">

            <!-- Employee Heldup Setup Form Section -->
            <section class="header-section">
                <app-expansion-panel-header 
                    [isOpenSignal]="heldupSetup" 
                    [panelTitle]="'Heldup Setup Information'">
                </app-expansion-panel-header>

                @if(heldupSetup()){
                <div class="py-1">
                    <div class="grid md:grid-cols-3 gap-x-4" [formGroup]="frmGroup">

                        <!-- ------ Heldup Type ------ -->
                        <input-select-option-field
                            [frmGroup]="frmGroup"
                            controlName="heldupType"
                            label="Heldup Type"
                            [options]="heldupType"
                            [searchable]="true"
                            [isReadonly]="isEdit"
                        />

                        <!-- ------ From Date ------ -->
                        <input-date 
                            [frmGroup]="frmGroup" 
                            [controlName]="'fromDate'" 
                            [label]="'From Date'"
                            [dateFormat]="'YYYY-MM-DD'"
                            [minDate]="getMinFromDate()"
                            [includeTime]="0"
                            [enableYearRangeValidation]="false">
                        </input-date>

                        <!-- ------ To Date ------ -->
                        <input-date 
                            [frmGroup]="frmGroup" 
                            [controlName]="'toDate'" 
                            [label]="'To Date'"                      
                            [dateFormat]="'YYYY-MM-DD'"
                            [minDate]="getMinToDate()"                           
                            [includeTime]="0"
                            [enableYearRangeValidation]="false">
                        </input-date>

                         <!-- ------ Remarks ------ -->
                         <div class="col-span-3">
                            <input-text-area 
                                [frmGroup]="frmGroup" 
                                [controlName]="'remark'" 
                                [label]="'Purpose'"
                                [isVertical]="true" 
                                [rows]="2" 
                                [placeholder]="'Enter remarks'">
                            </input-text-area>
                        </div>
                        

                        @if(+frmGroup.get('heldupType')?.value === 1 && salaryBreakups().length) {
                            <div class="col-span-3">
                                <generic-data-grid
                                    [id]="'heldup-setup-grid'"
                                    [dataSource]="dataSource()"
                                    [initPageSize]="10"
                                    [selectedColumns]="selectedColumns"
                                    [customColumnNames]="customColumnNames" 
                                    [editableColumns]="['value']"
                                    [numberColumns]="['amount', 'value']"   
                                    [showEditButton]="true"
                                    [useInlineEdit]="true"
                                    (dataSourceChanged)="onGridDataChanged($event)"
                                />
                            </div> 
                        }                      
                    </div>
                </div>
                }
            </section>
        </div>
    </div>

    <!-- -------------- Heldup view modal ----------- -->
    <generic-modal 
        [isVisible]="isModalShow" 
        [modalTitle]="'Employee Heldup List'" 
        [cssClass]="'modal-xl'"
        [modalComponent]="memberListModal" 
        (modalClosed)="isModalShow = false;"
        (modalResult)="getModalResult($event)">
    </generic-modal>

    <!-- -------------- Employee information modal ----------- -->
    <generic-modal 
        id="employeeSearchModal" 
        [isVisible]="showEmployeeModal()" 
        modalTitle="Select Employee"
        [showOkButton]="false"
        [modalComponent]="EmployeeSearchModal" 
        [modalComponentData]="employeeSearchModalData"
        (modalResult)="onEmployeeSelected($event)" 
        cssClass="modal-lg" 
        (modalClosed)="showEmployeeModal.set(false)">
    </generic-modal>